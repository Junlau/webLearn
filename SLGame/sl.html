<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>扫雷</title>
    <style>
        .connect {
            width: 198px;
            height: 198px;
            margin: auto;
        }
        ul {
            padding: 0px;
        }
        li {
            width: 20px;
            height: 20px;
            list-style: none;
            float: left;
            border: 2px solid;
            border-color: #fff #a1a1a1 #a1a1a1 #fff;
            background-color: #ccc;
        }

    </style>
</head>
<body>
    <div class="connect">
        <ul class="">
            
        </ul>
    </div>
</body>

<script>
    //外面确定行数、列数和雷的个数
    function Mine(tr, td, mineNum) {
        this.tr = tr; //行
        this.td = td; //列
        this.mineNum = mineNum; //雷的个数

        this.squares = []; //存储所有方块的数据，二维数组
        this.lis = []; //存储所有DOM元素，可以是二维数组也可以是一维数组

        this.surplusMine = mineNum; //剩余雷的个数
        this.allRight = false; //表示是都全部正确
        this.parent = document.getElementsByClassName('connect')[0];
    }

    Mine.prototype.creatView = function () {
        //确定每个格子的宽和高以及边框
        var width = 20;
        var height = 20;
        var borderWidth = 2;
        //根据每个格子的宽高计算容器的大小
        this.parent.style.width = (this.td * (width + borderWidth * 2)) + 'px';
        this.parent.style.height = (this.tr * (height + borderWidth * 2)) + 'px';

        //创建每个格子
        var ulEle = document.getElementsByTagName('ul')[0];
        ulEle.innerHTML = ""; //每次创建都清空
        var allNum = this.tr * this.td;
        for (let i = 0; i < allNum; i ++) {
            var liEle = document.createElement('li'); 
            liEle.innerHTML = "";
            liEle.index = i;
            this.lis.push(liEle);
            ulEle.appendChild(liEle);
        }

        //点击事件
        ulEle.onmousedown = function (event) {
            if (event.button == 0){
                //左键
            } else if (event.button == 2) {
                //右键
            }
        }

        //取消右键菜单弹出
        ulEle.oncontextmenu = function (e) {
            return false;
        }

    }

    //创造对应的数据
    Mine.prototype.creatData = function () {
        //先把雷的数据填入
        var mineArray = this.randomNum();
        var n = 0; 
        for (let i = 0; i < this.tr; i++) {
            this.squares[i] = []; //创建二维数组
            for (let j = 0; j < this.td; j++) {
                let data = {};
                if (mineArray.indexOf(n) == -1) {
                    //找不到则不是雷
                    data.type = "number";
                    data.x = i;
                    data.y = j;
                    data.value = 0;
                } else {
                    data.type = "mine";
                    data.x = i;
                    data.y = j;
                }
                this.squares[i].push(data);
                n++;
            }
        }

        //填充除了雷以外的value值
        for(let i = 0; i < this.tr; i++){
            for(let j = 0; j < this.td; j++) {
                let data = this.squares[i][j];
                if (data.type == "number") {
                    let count = 0;
                    if(j + 1 < this.td) {
                        let temp1 = this.squares[i][j + 1];
                        count = temp1.type == "mine" ? (count + 1) : count;
                    }
                    if(j - 1 >= 0) {
                        let temp2 = this.squares[i][j - 1];
                        count = temp2 == "mine" ? (count + 1) : count;
                    }

                    if(i + 1 < this.tr) {
                        if (j - 1 >= 0) {
                        let temp3 = this.squares[i + 1][j - 1];
                        count = temp3 == "mine" ? (count + 1) : count;
                        }
                        if (j + 1 < this.td) {
                            let temp4 = this.squares[i + 1][j + 1];
                            count = temp4 == "mine" ? (count + 1) : count;
                        }
                        let temp5 = this.squares[i + 1][j];
                        count = temp5 == "mine" ? (count + 1) : count;
                    }
                    if (i - 1 >= 0) {
                        if (j - 1 >= 0) {
                            let temp6 = this.squares[i - 1][j - 1];
                            count = temp6 == "mine" ? (count + 1) : count;
                        }
                        if (j + 1 < this.td) {
                            let temp7 = this.squares[i - 1][j + 1];
                            count = temp7 == "mine" ? (count + 1) : count;
                        }
                        let temp8 = this.squares[i - 1][j];
                        count = temp8 == "mine" ? (count + 1) : count;
                    }
                    data.value = count;
                }
            }
        }
    }

    //生成 n 个不重复的数字，雷的位置数据
    Mine.prototype.randomNum = function () {
        var array = new Array(this.tr * this.td);//生成一个空数组
        for (let i = 0; i < array.length; i++) {
            array[i] = i;
        }
        //通过排序生成随机数
        array.sort(function () {return 0.5-Math.random()});

        return array.slice(0, this.mineNum);
    }
    
    Mine.prototype.init = function () {
        this.creatView();
        this.creatData();

        for (let i = 0; i < this.lis.length; i++) {
            var liEle = this.lis[i];
            var tag = liEle.index;

            let x = Math.floor(tag/this.td);
            let y = tag%this.tr;

            var square = this.squares[x][y];

            if (square.type == 'mine') {
                liEle.innerHTML = '0';
            } else {
                liEle.innerHTML = square.value;
            }
        }
    }
    
    var mine = new Mine(9,9,10);
    mine.init();
    

</script>
</html>